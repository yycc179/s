<%include header%>

    <link rel="stylesheet" href="/stylesheets/dashboard.css">
    <link rel="stylesheet" href="/stylesheets/jquery.jqplot.css">

    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-9 col-md-2 sidebar">
                <ul class="nav nav-sidebar">
                    <li <%=current ? "" : "class=active"%>>
                        <a href="/web/stats/peer">All</a>
                    </li>
                    <% countries.forEach(country => {%>
                        <li <%=country._id===current ? "class=active" : ""%>>
                            <a href="/web/stats/peer/<%=country._id%>">
                                <%=country._id%>
                            </a>
                        </li>
                        <%})%>
                </ul>
            </div>

            <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
                <div id="chart1" style="height:400px;width:80%"></div>
                <table class="table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>
                                <%=current?"City":"Country"%> name
                            </th>
                            <th>Peer count</th>
                        </tr>
                    </thead>

                    <tbody>
                        <% datas.forEach(function(data, i){ %>
                            <tr>
                                <th scope="row">
                                    <%=i%>
                                </th>
                                <td>
                                    <%=data._id%>
                                </td>
                                <td>
                                    <%=data.count%>
                                </td>
                            </tr>
                            <% })%>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="/javascripts/jquery.jqplot.min.js"></script>
    <script src="/javascripts/plugins/jqplot.categoryAxisRenderer.min.js"></script>
    <script src="/javascripts/plugins/jqplot.canvasAxisTickRenderer.min.js"></script>
    <script src="/javascripts/plugins/jqplot.canvasTextRenderer.min.js"></script>
    <script src="/javascripts/plugins/jqplot.pointLabels.min.js"></script>
    <script src="/javascripts/plugins/jqplot.barRenderer.min.js"></script>
    <script src="/javascripts/plugins/jqplot.canvasAxisLabelRenderer.min.js"></script>

    <script src="https://unpkg.com/babel-standalone@6/babel.js"></script>

    <script type="text/babel"> 
        var data = [
            <% datas.forEach((data, i) => {
                if (i < 20) {%>
                    ['<%=data._id%>', <%=data.count %>],
                    <%}}) %>];

        $('#chart1').jqplot([data], {
            title: 'Peer distribution',
            animate: !$.jqplot.use_excanvas,
            seriesDefaults: {
                renderer: $.jqplot.BarRenderer,
                pointLabels: { show: true, ypadding: 0 },
                rendererOptions: {
                    barWidth: 30,
                    shadow: true,
                    varyBarColor: true
                },
            },

            axesDefaults: {
                tickRenderer: $.jqplot.CanvasAxisTickRenderer,
                tickOptions: {
                    fontFamily: 'Georgia',
                    fontSize: '15pt',
                    angle: -30
                }
            },
            axes: {
                xaxis: {
                    renderer: $.jqplot.CategoryAxisRenderer,
                },
                yaxis: {
                    labelRenderer: $.jqplot.CanvasAxisLabelRenderer,
                    label: "Peer Count",
                    tickOptions: {
                        formatString: '%d'
                    },
                }
            }
        });
    </script>

    <%include footer%>